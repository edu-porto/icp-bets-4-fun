FROM ubuntu:22.04

# Set environment variables
ENV DEBIAN_FRONTEND=noninteractive
ENV NODE_VERSION=18

# Install system dependencies
RUN apt-get update && apt-get install -y \
    curl \
    wget \
    git \
    build-essential \
    ca-certificates \
    vim \
    nano \
    && rm -rf /var/lib/apt/lists/*

# Install Node.js
RUN curl -fsSL https://deb.nodesource.com/setup_${NODE_VERSION}.x | bash - \
    && apt-get install -y nodejs

# Set working directory
WORKDIR /app

# Copy project files
COPY . .

# Install frontend dependencies
RUN cd src/frontend && npm install

# Expose ports
EXPOSE 8000 3000 4943

# Create a helpful startup script
RUN echo '#!/bin/bash\n\
echo "🐳 ICP Bets Development Environment Ready!"\n\
echo ""\n\
echo "📚 To install DFX, run this command:"\n\
echo "  sh -ci \"\$(curl -fsSL https://internetcomputer.org/install.sh)\""\n\
echo ""\n\
echo "🔧 After installing DFX, you can:"\n\
echo "  dfx start --background    # Start local Internet Computer"\n\
echo "  dfx deploy               # Deploy all canisters"\n\
echo "  dfx canister open frontend  # Open frontend in browser"\n\
echo ""\n\
echo "🌐 Ports:"\n\
echo "  - 8000: DFX local network"\n\
echo "  - 3000: Frontend dev server"\n\
echo "  - 4943: Internet Identity"\n\
echo ""\n\
echo "🚀 Quick start:"\n\
echo "  1. Install DFX (see above)"\n\
echo "  2. dfx start --background"\n\
echo "  3. dfx deploy"\n\
echo "  4. dfx canister open frontend"\n\
echo ""\n\
bash' > /start.sh && chmod +x /start.sh

# Set the startup script as entrypoint
ENTRYPOINT ["/start.sh"] 